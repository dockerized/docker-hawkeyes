version: "2"
volumes:
  influxdb_data:
      driver: local
  chronograf_data:
      driver: local
  kapacitor_data:
      driver: local
services:
  influxdb:
    image: nexia/influxdb
    ports:
      - "9083:8083"
      - "9086:8086"
    volumes:
      - influxdb_data:/var/lib/influxdb/
    networks:
      - back-tier
  telegraf:
    image: nexia/telegraf 
    depends_on:
      - influxdb
    volumes:
      - ./telegraf/:/etc/telegraf/
    links:
      - influxdb
    networks:
      - back-tier
    command:
      - "telegraf"
      - "-config"
      - "/etc/telegraf/telegraf.conf"
      - "-config-directory"
      - "/etc/telegraf/telegraf.d"
  chronograf:
    image: nexia/chronograf
    depends_on:
      - influxdb
    ports:
      - "11000:10000"
    environment:
      CHRONOGRAF_BIND: 0.0.0.0:10000
      CHRONOGRAF_LOCAL_DATABASE: /data/chronograf.db
    volumes:
      - chronograf_data:/data/
    networks:
      - front-tier
      - back-tier
  kapacitor:
    image: nexia/kapacitor
    depends_on:
      - influxdb
    ports:
      - "19092:9092"
    volumes:
      - kapacitor_data:/var/lib/kapacitor/
    networks:
      - front-tier
      - back-tier
networks:
  front-tier:
    driver: bridge
  back-tier:
    driver: bridge